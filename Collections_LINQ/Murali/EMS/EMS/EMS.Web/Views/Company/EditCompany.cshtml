@model EMS.Web.Models.CompanyViewModel
@{
	Layout = "~/Views/Shared/_EMSLayout.cshtml";
	int counter = 0;
	int index = -1;
}

<div class="container">
	<h2>Edit Company</h2>
	<input type="hidden" asp-for="CompanyIdPk" />
	<hr />
	<div class="row">
		<div class="form-group col-5">
			<label class="control-label fw-bold">Name:</label>
			<input class="form-control" readonly asp-for="CompanyName" />
		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">Registration Date:</label>
			<input type="date"
				   name="RegistrationDate"
				   value="@Model.RegistrationDate"
				   class="form-control" />

		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">Website:</label>
			<input class="form-control" maxlength="500" asp-for="Website" />
		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">BankAccountNumber:</label>
			<input class="form-control" maxlength="50" asp-for="BankAccountNumber" />
		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">Email:</label>
			<input class="form-control" type="email" maxlength="100" asp-for="Email" />
		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">PhoneNumber:</label>
			<input class="form-control" type="number" asp-for="PhoneNumber" />
		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">TIN:</label>
			<input class="form-control" maxlength="20" asp-for="TIN" />
		</div>
		<div class="form-group col-5">
			<label class="control-label fw-bold">PAN:</label>
			<input class="form-control" maxlength="10" asp-for="PAN" />
		</div>
	</div>
	<hr />
	<h3>Address(es)</h3>
	<hr />
	<div class="row">
		<div class="col-2">Address Line1</div>
		<div class="col-2">Address Line2</div>
		<div class="col-2">City</div>
		<div class="col-2">State</div>
		<div class="col-2">PIN</div>
		<div class="col-2">Type</div>
		<div class="col-2"><input type="text" id="inputLine1" /></div>
		<div class="col-2"><input type="text" id="inputLine2" /></div>
		<div class="col-2"><input type="text" id="inputCity" /></div>
		<div class="col-2"><input type="text" id="inputState" /></div>
		<div class="col-2"><input type="text" id="inputPIN" /></div>
		<div class="col-2">
			<input type="radio" id="inputCorp" name="inputType" value="1" />Corporate
			<input type="radio" id="inputBranch" name="inputType" value="2" />Branch
		</div>
		<div class="col-12">
			<input type="button" class="btn btn-secondary" value="ADD" onclick="AddAddress()" />
			<input type="button" class="btn btn-dotted" value="Cancel" onclick="ClearAddress()" />
		</div>
	</div>
	<hr />

	<table class="table info-table">
		<thead>
			<tr>
				<th>#</th>
				<th>Line1</th>
				<th>Line2</th>
				<th>City</th>
				<th>State</th>
				<th>PIN</th>
				<th>Type</th>
				<th>Edit</th>
				<th>Delete</th>
			</tr>
		</thead>
		<tbody id="address-table">
			@foreach (var address in Model.CompanyAddresses)
			{
				<tr>
					<td>@(++counter)</td>
					<td>@address.AddressLine1</td>
					<td>@address.AddressLine2</td>
					<td>@address.City</td>
					<td>@address.State</td>
					<td>@address.PinCode</td>
					<td>@address.AddressTypeName</td>
					<td><a href="#" onclick="EditAddress(@index)">Edit</a></td>
					<td><a href="#" onclick="DeleteAddress(@index)">Delete</a></td>
				</tr>
			}
			@foreach (var address in Model.CompanyAddresses)
			{
				<tr>
					<td>@(++counter)</td>
					<td>@address.AddressLine1</td>
					<td>@address.AddressLine2</td>
					<td>@address.City</td>
					<td>@address.State</td>
					<td>@address.PinCode</td>
					<td>@address.AddressTypeName</td>
					<td><a href="#" onclick="EditAddress(@index)">Edit</a></td>
					<td><a href="#" onclick="DeleteAddress(@index)">Delete</a></td>
				</tr>
			}
		</tbody>
	</table>
	<hr />
	<div class="row">
		<div class="col-10">
			&nbsp;
		</div>
		<div class="col-4">
			<input type="button" class="btn btn-primary" onclick="SaveCompany()" value="Save" />
			<a class="btn btn-secondary" asp-action="view" asp-controller="company">Cancel or Back to View</a>
		</div>
	</div>
</div>

<div class="alert alert-warning alert-dismissible fade show" role="alert">
	<strong>Warning!</strong> <label id="lblWarningMessage"></label>
	<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>


<script type="text/javascript">
	
		function SaveCompany() {
		let companyObj = {
			CompanyIdPk: document.querySelector('[name="CompanyIdPk"]').value,
			RegistrationDate: document.querySelector('[name="RegistrationDateDisplayValue"]').value,
			Website: document.querySelector('[name="Website"]').value,
			BankAccountNumber: document.querySelector('[name="BankAccountNumber"]').value,
			Email: document.querySelector('[name="Email"]').value,
			PhoneNumber: document.querySelector('[name="PhoneNumber"]').value,
			TIN: document.querySelector('[name="TIN"]').value,
			PAN: document.querySelector('[name="PAN"]').value
		};

		fetch('/company/editcompany', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(companyObj)
		})
		.then(response => response.json())
		.then(data => {
			if (data.isSuccess) {
				alert('Company details saved successfully');
				window.location.href = '/company/view';
			} else {
				alert(data.errorMessage);
			}
		})
		.catch(() => {
			alert('Something went wrong while saving company info');
		});
	}

	function EditAddress(rowIndex){

	} 
	function DeleteAddress(rowIndex){

	}

	function AddAddress(){
		debugger;
		let line1 = document.getElementById('inputLine1').value;
		let line2 = document.getElementById('inputLine2').value;
		let city = document.getElementById('inputCity').value;
		let state = document.getElementById('inputState').value;
		let pin = document.getElementById('inputPIN').value;
		let typeId ;
		let typeName = '';

		if(document.getElementById('inputCorp').checked){
			typeId = 1;
			typeName = 'Corporate office';
		}else if(document.getElementById('inputBranch').checked){
			typeId = 2;
			typeName = 'Branch office';
		}

		if(!line1.trim()){
			showMessage('Address Line1 is required.');
			return;
		}
		if(!city.trim()){
			showMessage('City is required.');
			return;
		}
		if(!state.trim()){
			showMessage('State is required.');
			return;
		}
		if(!typeId){
			showMessage('Type is required.');
			return;
		}

		var count = document.getElementById('address-table').children.length;

		var data = [count+ 1, line1, line2, city, state, pin, typeName, '<a href="#" onclick="EditAddress('+count-1+')">Edit</a>',
		'<a href="#" onclick="DeleteAddress('+count-1+')">Delete</a>'];
		addRowToTable(data);
	}

	function ClearAddress(){

	}

	function showMessage(msg){
		alert(msg);
	}

		// Function to add a new row with specific data
	function addRowToTable(data) {
	  // 1. Get the tbody element
	  const tbody = document.getElementById('address-table');

	  // 2. Create a new row (tr) element
	  const newRow = document.createElement('tr');

	  // 3. Iterate over the data to create cells (td)
	  data.forEach(cellText => {
		// Create a new cell (td) element
		const cell = document.createElement('td');

		// Create a text node with the cell content
		const cellContent = document.createTextNode(cellText);

		// Append the text node to the cell
		cell.appendChild(cellContent);

		// Append the cell to the new row
		newRow.appendChild(cell);
	  });

	  // 4. Append the new row to the tbody
	  tbody.appendChild(newRow);
	}

	// Example usage:
	// Assuming you have a table like:
	// <table id="myTable">
	//   <tbody id="myTableBody">
	//     <!-- existing rows can be here -->
	//   </tbody>
	// </table>

	// Add a new row with data: ['Item A', 'Item B', 'Item C']
	//addRowToTable(['New Data 1', 'New Data 2', 'New Data 3']);
	
	

</script>